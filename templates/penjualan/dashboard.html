{% extends 'base.html'%}
{% load static %}
{% block menu %}
<div class="container h1 text-center">
Penjualan
</div>
{% endblock%}
{% block contents %}

        <!-- The Modal -->
        <div class="modal fade vh-100" id="myModal2">
            <div class="modal-dialog w-100 ">
                <div class="modal-content">
            
                  <!-- Modal Header -->
                  <div class="modal-header text-white fw-bold bg-danger">
                    <h4 class="modal-title text-white" id="header_modal2"></h4> &nbsp;&nbsp;
                    {% if user.is_authenticated %}
                    <span id="setwishlist" onclick="setwishlist()"></span>
                    {% endif %}

                    <input type="hidden" id="kode_barang_cart">
                    <input type="hidden" id="harga_asli">
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                  </div>
            
                  <!-- Modal body -->
                  <div class="modal-body">
                      <div class="d-flex justify-content-end container"  >
                      </div>
                      <div class="d-flex row justify-content-center">
                          <div class="d-flex  overflow-auto p-2 " id="gambar_model2"></div>
                          <div class="  my-2 border border-danger border-1 bg-white shadow p-2">
                              <div><u>DESKRIPSI PRODUK:</u></div>
                              <div id="isi_modal2" class=" overflow-auto" style="height:100px"></div>
                              <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex col-6 my-2 text-danger"><span class="py-2">Jumlah: </span><input type="Number" min="1" id="jumlah_item" value="1" class="mx-2 form-control w-50" onkeyup="update_jumlah()"></div>
                                <div class="col-6">
                                    <div class="text-center">Harga : <span id="harga2" class="fw-bold"></div>      
                                </div>  
                              </div>
                              
                          </div>
                          <div class="my-2 p-2 border border-danger border-1 ">
                              <div class="justify-content-center d-flex"><div class="mx-2"><strong>Total Belanjamu:</div> <div class="mx-2" id="harga_totalnya"></div></strong></div>
                              <div class="justify-content-evenly d-flex">
                                  <button class="btn btn-primary" style="font-size:12px" onclick="addCart()"><i class="fa fa-cart-plus mx-2"></i> Masukkan Keranjang</button>
                                  <button class="btn btn-success" style="font-size:12px"><i class="fa fa-credit-card mx-2"></i> Beli Sekarang</button>
                              </div>
                          </div>
  
                      </div>
                  </div>
            
                  <!-- Modal footer -->
                  <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Tutup</button>
                  </div>
            
                </div>
              </div>
        </div>
          <!--end of modal-->
          
    <!--modal hapus cart-->
    <div class="modal fade" id="modalHapusCart">

        <div class="modal-dialog w-100">
            <div class="modal-content">

              <!-- Modal Header -->
              <div class="modal-header text-white fw-bold bg-warning">
                <h2 class="modal-title text-white fw-bold" id="mhc_header">Hapus Item?</h2>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>

              <!-- Modal body -->
              <div class="modal-body">
                <div id="mhc_body">Mau DIhapus?</div>
              </div>

              <!-- Modal footer -->
              <div class="modal-footer d-flex justify-content-center">
                <button type="button" class="mx-2 btn btn-outline-danger" data-bs-dismiss="modal">Batal</button>
                <button type="button" class="mx-2 btn btn-outline-danger" data-bs-dismiss="modal" onclick="hapusCart()">Hapus</button>
            </div>

            </div>
          </div>
      </div>
    <!--end modal hapuscart-->

    <!--modal konfirmasi-->
    <div class="modal fade" id="modalKonfirmasi">

        <div class="modal-dialog w-100">
            <div class="modal-content">

              <!-- Modal Header -->
              <div class="modal-header text-white fw-bold bg-warning">
                <h2 class="modal-title text-white fw-bold" id="konfirmasi_header"></h2>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>

              <!-- Modal body -->
              <div class="modal-body">
                <div id="konfirmasi_body"></div>
              </div>

              <!-- Modal footer -->
              <div class="modal-footer d-flex justify-content-center">
                <button type="button" class="mx-2 btn btn-outline-danger" data-bs-dismiss="modal">OK</button>
            </div>

            </div>
          </div>
      </div>
    <!--end modal konfirmasi-->

<div class="row d-flex justify-content-center" style="margin-top:20px">
    <div class=" fw-bold d-flex justify-content-between  rounded  shadow  text-white border  col-11 " style="background-color:red" >
        <div class="p-1">
            <i class="fa fa-cloud-upload"  style="margin-right:20px"></i>  Produk <strong>Terbaru!</strong>
        </div>
        <div  class="bg-white rounded-circle justify-content-center align-items-center d-flex" style="width:35px;height:35px">
            <img src={% static 'img/wow.png'%} style="width:35px;height:30px">
        </div>
    </div>
</div>
<div class="container-fluid d-flex justify-content-center border border-danger border-1 rounded rounded-top  col-11">
    <div class="d-flex overflow-auto mx-2 p-2" id="list_items"  ></div>
</div>

<div class="row d-flex justify-content-center" style="margin-top:20px" >
    <div class=" fw-bold d-flex justify-content-between  rounded  shadow  text-white border  col-11 " style="background-color:red" >

        <div class="p-1">
            <i class="fa fa-gratipay" style="margin-right:20px"></i> <strong>Pilihan</strong> Pembeli
        </div>
        <div  class="bg-white rounded-circle justify-content-center d-flex" style="width:35px;height:35px">
            <img src={% static 'img/ok_red.png'%} style="width:25px;height:25px">
        </div>
    </div>
</div>
<div class="container-fluid d-flex justify-content-center border border-danger border-1 rounded rounded-top  col-11">
    <div class="d-flex overflow-auto mx-2 p-2" id="list_items2"></div>
</div>

<div class="row d-flex justify-content-center" style="margin-top:20px">
    <div class=" fw-bold d-flex justify-content-between  rounded  shadow  text-white border  col-11 " style="background-color:red" >
        <div class="p-1">
            <i class="fa fa-handshake-o" style="margin-right:20px"></i></i> <strong>Cuci</strong> Gudang - DISKON BESAR!
        </div>
        <div  class="bg-white rounded-circle justify-content-center align-items-center d-flex" style="width:35px;height:35px">
            <img src={% static 'img/discount.png'%} style="width:35px;height:25px">
        </div>
    </div>
</div>
<div class="container-fluid d-flex justify-content-center border border-danger border-1 rounded rounded-top  col-11">
    <div class="d-flex overflow-auto mx-2 p-2" id="list_items3"></div>
</div>

<div class="row d-flex justify-content-center" style="margin-top:20px">
    <div class=" fw-bold d-flex justify-content-between  rounded  shadow  text-white border  col-11 " style="background-color:red" >
        <div class="p-1">
            <i class="fa fa-gg-circle" style="margin-right:20px"></i></i> <strong>Produk</strong> Terbaik!
        </div>
        <div  class="bg-white rounded-circle justify-content-center align-items-center d-flex" style="width:35px;height:35px">
            <img src={% static 'img/jagoanhelm.png'%} style="width:35px;height:35px">
        </div>
    </div>
</div>
<div class="container">
    <div class="row d-flex justify-content-evenly" style="margin-top:15px" id="all_list">
    </div>
</div>

<!--tampilan untuk hp-->
<!--
<div class="d-block d-sm-block d-md-none d-lg-none d-xl-none d-xxl-none container">
    <div class="mt-2 p-2 border border-danger border-1 w-100 bg-danger text-white rounded">
        <span class="h3 fw-bold">Helm Zorin</span>
    </div>
    <div class="mt-2 p-2 border border-danger border-1 w-100 bg-white  rounded">
        <p>{% lorem 1 b random %}</p>
        <div class=" d-flex justify-content-evenly">
            <div class="col-1 ">Qty:</div>
            <div class="col-3"><input type="text" class=" py-1 w-50 border border-danger border-1" style="height:25px"></div>
            <div class="col-4"><button class="rounded border-success border border-1 text-success"><i class="fa fa-cart-shopping text-success "></i> Add Cart</button></div>
            <div class="col-4"><button class="rounded border-primary border border-1 text-primary"><i class="fa-regular fa-money-bill-1 text-primary"></i> Buy Now</button></div>
        </div>
    </div>
</div> -->
    <!--end of tampilan hp-->
<!--tampilan PC-->
<!--
<div class="container-fluid my-3 mx-2 d-none d-sm-none d-md-block d-lg-block d-xl-block d-xxl-block">
    <div class="row d-flex">
            <div class="col-6">
                <div class="mt-2 p-2 border border-danger border-1 w-100 bg-danger text-white rounded">
                    <span class="h3 fw-bold">Helm Zorin</span>
                </div>
                <div class="mt-2 p-2 border border-danger border-1 w-100 bg-white  rounded">
                    <p>{% lorem 1 b random %}</p>
                    <div class=" d-flex justify-content-between">
                        <div class="col-1 ">Qty:</div>
                        <div class="col-3"><input type="text" class=" py-1 w-50 border border-danger border-1" style="height:25px"></div>
                        <div class="col-4"><button class="border-success border border-1 rounded-pill text-success"><i class="fa fa-cart-shopping text-success "></i> Add Cart</button></div>
                        <div class="col-4"><button class="border-primary border border-1 rounded-pill text-primary"><i class="fa-regular fa-money-bill-1 text-primary"></i> Buy Now</button></div>
                    </div>
                </div>
            </div>
            <div class="col-6">
            </div>
    </div>
</div>
-->
<!--end of tampilan pc-->
<br><br><br>
<script>

    $(document).ready(function() {
        //untuk setting jumlah cart
        $.ajax({
            type: "POST",
            url: "/get/cart/",
            data: {
                'csrfmiddlewaretoken':csrfmiddlewaretokennya,
                '':''
            },
            success: function(data) {
                console.log(data);
                if(data.jumlah_shopping>99) {
                    $("#jumlah_cart").text("99+");
                    $("#jumlah_cart2").text("99+");
                } else {
                    $("#jumlah_cart").text(data.jumlah_shopping);
                    $("#jumlah_cart2").text(data.jumlah_shopping);
                }
                if(data.myshoppingcart.length ==0) {
                    $("#myshoppingcart").html("<div class='px-2 py-4 text-center'>Belum ada barang dikeranjangmu!<br>yuk... mulai belanja!</div>");
                    $("#listCartHP").html("<div class='px-2 py-4 text-center'>Belum ada barang dikeranjangmu!<br>yuk... mulai belanja!</div>");

                }
                
                data.myshoppingcart.forEach(function(mydata) {
                    comp_hp = "<div class='p-2 m-2 border border-danger rounded' style='cursor:pointer' id='listHP_" + mydata.kode_produk.produk_kode +"'><div class='row'><div class='col-3 d-flex align-items-center'><img class='w-100  rounded ' src='"+ mydata.kode_produk.gambar1 +"'></div><div class='col-9 d-flex align-items-center  py-2'><strong style='font-size:12px'>"+ mydata.kode_produk.produk_nama.toUpperCase() + "<strong><br>Jumlah Shopping Cart: <strong>" + mydata.jumlah +"</strong> item (s)<br>Harga Satuan : " + ubahKeUang(mydata.kode_produk.produk_harga) +"<br>Total Belanja:" + ubahKeUang(mydata.total_harga) +"</div></div></div>";
                    comp_komputer = "<li class='p-1 m-2 border border-danger rounded' id='listComp_" + mydata.kode_produk.produk_kode +"' title='klik untuk membeli: " + mydata.kode_produk.produk_nama.toUpperCase() +"'><a class='dropdown-item' href='#' style='font-size:10px'><div class='row '><div class='col-3  d-flex align-items-center'><img class='w-100  rounded ' src='"+ mydata.kode_produk.gambar1 +"'></div><div class='col-9 d-flex align-items-center  py-2'><strong style='font-size:12px'>"+ mydata.kode_produk.produk_nama.toUpperCase() + "<strong><br>Jumlah Shopping Cart: <strong>" + mydata.jumlah +"</strong> item (s)<br>Harga Satuan : "+ ubahKeUang(mydata.kode_produk.produk_harga) +"<br>Total Belanja:" + ubahKeUang(mydata.total_harga) +"</div></div></a></li>";
                    $("#myshoppingcart").append(comp_komputer);
                    $("#listCartHP").append(comp_hp);
                    $("#listHP_" + mydata.kode_produk.produk_kode).click(function() {
                        get_produk_satu(mydata.kode_produk.produk_kode);
                    });
                    $("#listComp_" + mydata.kode_produk.produk_kode).click(function() {
                        get_produk_satu(mydata.kode_produk.produk_kode);
                    });
                    //print(mydata.kode_produk);
                });
                
                $.ajax({
                    type: "PoST",
                    url: '/wishlist/jumlah/',
                    data : {
                        'csrfmiddlewaretoken':csrfmiddlewaretokennya
                    },
                    success: function(data) {
                        if (parseInt(data.result)>99) {
                            $("#jumlah_whislist").text("99+");
                            $("#jumlah_whislist2").text("99+");
                        } else {
                            $("#jumlah_whislist").text(data.result);
                            $("#jumlah_whislist2").text(data.result);
                        }
                    }
                });
            }
        });

        $.post('/api/get/produk/',{
            'filter':'',
            'csrfmiddlewaretoken':$("input[name=csrfmiddlewaretoken]").val(),
        },
        function(data) {
            data.forEach(function(element){
                let gambar = [];
                if (element.gambar1!=null)
                    gambar.push(element.gambar1);
                if (element.gambar2!=null)
                    gambar.push(element.gambar2);
                if (element.gambar3!=null)
                    gambar.push(element.gambar3);
                if (element.gambar4!=null)
                    gambar.push(element.gambar4);
                if (element.gambar5!=null)
                    gambar.push(element.gambar5);
                if (element.gambar6!=null)
                    gambar.push(element.gambar6);
                if (element.gambar7!=null)
                    gambar.push(element.gambar7);
                if (element.gambar8!=null)
                    gambar.push(element.gambar8);

                let template = "<div class='items mx-2 bg-white' style='border: 1px solid lightcoral' id='terbaru_"+element.produk_kode+"'>" +
                    "<img src='" + element.gambar1 +"'  style='border:1px solid white;height:100px;width:140px;margin-top:10px;margin-bottom:10px;border-radius:10px'/>" +
                    "<p><strong>"+element.produk_nama+"</strong></p>"+
                    "<p>Harga: <strong>" + ubahKeUang(element.produk_harga) +"</strong></p></div>";
                    $("#list_items").append(template);
                    $("#terbaru_" + element.produk_kode).click(function() {
                        $("#header_modal2").text(element.produk_nama);
                        $("#kode_barang_cart").val(element.produk_kode);
                        $("#isi_modal2").html(ubahEnter(element.produk_deskripsi));
                        $("#harga2").text(ubahKeUang(element.produk_harga));
                        //get the jumlah :-)
                        $.ajax({
                            type: 'POST',
                            url: '/get/cart/jumlah/',
                            data: {
                                'csrfmiddlewaretoken':csrfmiddlewaretokennya,
                                'kode_barang':element.produk_kode
                            },
                            success: function(data) {
                                $("#jumlah_item").val(data.jumlah);
                                $("#harga_totalnya").text(ubahKeUang(parseInt(data.jumlah)*element.produk_harga));
                            }
                        });
                        $("#harga_asli").val(element.produk_harga);
                        $("#gambar_model2").empty();
                        for(let i=0;i<gambar.length;i++) {
                            $("#gambar_model2").append(
                                "<img src='" + gambar[i]+"' class='mx-2 rounded shadow items2' >"
                            );
                        };
                        $("#setwishlist").empty();
                        $.ajax({
                            type: "POST",
                            url: "/wishlist/",
                            data: {
                                'csrfmiddlewaretoken':csrfmiddlewaretokennya,
                                'produk_id': element.produk_kode,
                                'ubah':false,
                            },
                            success: function(data) {
                                if(data.result==true) {
                                    $("#setwishlist").append("<i class='fa fa-heart text-white fw-bold' style='font-size:20px;cursor:pointer;' title='remove from my wishlist!'></i>");
                                }  else {
                                    $("#setwishlist").append("<i class='fa fa-heart-o text-white fw-bold' style='font-size:20px;cursor:pointer;' title='add to my wishlist!'></i>");
                                };
                                
                
                            }
                        });
                        $("#myModal2").modal("show");
                    });
                template = "<div class='items mx-2 bg-white' style='border: 1px solid lightcoral' id='pilihan_"+element.produk_kode+"'>" +
                        "<img src='" + element.gambar1 +"'  style='border:1px solid white;height:100px;width:140px;margin-top:10px;margin-bottom:10px;border-radius:10px'/>" +
                        "<p><strong>"+element.produk_nama+"</strong></p>"+
                        "<p>Harga: <strong>" + ubahKeUang(element.produk_harga) +"</strong></p></div>";
                        $("#list_items2").append(template);
                        $("#pilihan_" + element.produk_kode).click(function() {
                            $("#header_modal2").text(element.produk_nama);
                            $("#kode_barang_cart").val(element.produk_kode);
                            $("#isi_modal2").html(ubahEnter(element.produk_deskripsi));
                            $("#harga2").text(ubahKeUang(element.produk_harga));   
                            $("#harga_asli").val(element.produk_harga);  
                            //get the jumlah :-)
                            $.ajax({
                                type: 'POST',
                                url: '/get/cart/jumlah/',
                                data: {
                                    'csrfmiddlewaretoken':csrfmiddlewaretokennya,
                                    'kode_barang':element.produk_kode
                                },
                                success: function(data) {
                                    $("#jumlah_item").val(data.jumlah);
                                    $("#harga_totalnya").text(ubahKeUang(parseInt(data.jumlah)*element.produk_harga));
                                }
                            });
                            $("#gambar_model2").empty();
                            for(let i=0;i<gambar.length;i++) {
                                $("#gambar_model2").append(
                                    "<img src='" + gambar[i]+"' class='items2 mx-2 rounded shadow' >"
                                );
                            } 
                            $("#setwishlist").empty();
                            $.ajax({
                                type: "POST",
                                url: "/wishlist/",
                                data: {
                                    'csrfmiddlewaretoken':csrfmiddlewaretokennya,
                                    'produk_id': element.produk_kode,
                                    'ubah':false,
                                },
                                success: function(data) {
                                    if(data.result==true) {
                                        $("#setwishlist").append("<i class='fa fa-heart text-white fw-bold' style='font-size:20px;cursor:pointer;' title='remove from my wishlist!'></i>");
                                    }  else {
                                        $("#setwishlist").append("<i class='fa fa-heart-o text-white fw-bold' style='font-size:20px;cursor:pointer;' title='add to my wishlist!'></i>");
                                    };
                                    
                                }
                            });
                            $("#myModal2").modal("show");
                        });    
                template = "<div class='items mx-2 bg-white' style='border: 1px solid lightcoral' id='diskon_"+element.produk_kode+"'>" +
                            "<img src='" + element.gambar1 +"'  style='border:1px solid white;height:100px;width:140px;margin-top:10px;margin-bottom:10px;border-radius:10px'/>" +
                            "<p><strong>"+element.produk_nama+"</strong></p>"+
                            "<p>Harga: <strong>" + ubahKeUang(element.produk_harga) +"</strong></p></div>";
                            $("#list_items3").append(template);
                            $("#diskon_" + element.produk_kode).click(function() {
                                $("#header_modal2").text(element.produk_nama);
                                $("#kode_barang_cart").val(element.produk_kode);
                                $("#isi_modal2").html(ubahEnter(element.produk_deskripsi));
                                $("#harga2").text(ubahKeUang(element.produk_harga));   
                                $("#harga_asli").val(element.produk_harga);   
                                //get the jumlah :-)
                                $.ajax({
                                    type: 'POST',
                                    url: '/get/cart/jumlah/',
                                    data: {
                                        'csrfmiddlewaretoken':csrfmiddlewaretokennya,
                                        'kode_barang':element.produk_kode
                                    },
                                    success: function(data) {
                                        $("#jumlah_item").val(data.jumlah);
                                        $("#harga_totalnya").text(ubahKeUang(parseInt(data.jumlah)*element.produk_harga));
                                    }
                                });
                                $("#gambar_model2").empty();
                                for(let i=0;i<gambar.length;i++) {
                                    $("#gambar_model2").append(
                                        "<img src='" + gambar[i]+"' class='items2 mx-2 rounded shadow'>"
                                    );
                                }    
                                $("#setwishlist").empty();
                                $.ajax({
                                    type: "POST",
                                    url: "/wishlist/",
                                    data: {
                                        'csrfmiddlewaretoken':csrfmiddlewaretokennya,
                                        'produk_id': element.produk_kode,
                                        'ubah':false,
                                    },
                                    success: function(data) {
                                        if(data.result==true) {
                                            $("#setwishlist").append("<i class='fa fa-heart text-white fw-bold' style='font-size:20px;cursor:pointer;' title='remove from my wishlist!'></i>");
                                        }  else {
                                            $("#setwishlist").append("<i class='fa fa-heart-o text-white fw-bold' style='font-size:20px;cursor:pointer;' title='add to my wishlist!'></i>");
                                        };
                                        
                        
                                    }
                                });
                                $("#myModal2").modal("show");
                            });
                template = "<div class='items mx-2 bg-white' style='border: 1px solid lightcoral' id='semua_"+element.produk_kode+"'>" +
                                "<img src='" + element.gambar1 +"'  style='border:1px solid white;height:100px;width:140px;margin-top:10px;margin-bottom:10px;border-radius:10px'/>" +
                                "<p><strong>"+element.produk_nama+"</strong></p>"+
                                "<p>Harga: <strong>" + ubahKeUang(element.produk_harga) +"</strong></p></div>";
                                $("#all_list").append(template);
                                $("#semua_" + element.produk_kode).click(function() {
                                    $("#header_modal2").text(element.produk_nama);
                                    $("#kode_barang_cart").val(element.produk_kode);
                                    $("#isi_modal2").html(ubahEnter(element.produk_deskripsi));
                                    $("#harga2").text(ubahKeUang(element.produk_harga)); 
                                    $("#harga_asli").val(element.produk_harga);
                                    //get the jumlah :-)
                                    $.ajax({
                                        type: 'POST',
                                        url: '/get/cart/jumlah/',
                                        data: {
                                            'csrfmiddlewaretoken':csrfmiddlewaretokennya,
                                            'kode_barang':element.produk_kode
                                        },
                                        success: function(data) {
                                            $("#jumlah_item").val(data.jumlah);
                                            $("#harga_totalnya").text(ubahKeUang(parseInt(data.jumlah)*element.produk_harga));
                                        }
                                    });
                                    $("#gambar_model2").empty();      
                                    for(let i=0;i<gambar.length;i++) {
                                        $("#gambar_model2").append(
                                            "<img src='" + gambar[i]+"' class='items2 mx-2 rounded shadow' >"
                                        );
                                    }       
                                    $("#setwishlist").empty();
                                    $.ajax({
                                        type: "POST",
                                        url: "/wishlist/",
                                        data: {
                                            'csrfmiddlewaretoken':csrfmiddlewaretokennya,
                                            'produk_id': element.produk_kode,
                                            'ubah':false,
                                        },
                                        success: function(data) {
                                            if(data.result==true) {
                                                $("#setwishlist").append("<i class='fa fa-heart text-white fw-bold' style='font-size:20px;cursor:pointer;' title='remove from my wishlist!'></i>");
                                            }  else {
                                                $("#setwishlist").append("<i class='fa fa-heart-o text-white fw-bold' style='font-size:20px;cursor:pointer;' title='add to my wishlist!'></i>");
                                            };
                                            
                            
                                        }
                                    });
                                    $("#myModal2").modal("show");
                                });                    
                    /*$("#list_items").append(template);
                    $("#list_items").append(template);
                    $("#list_items").append(template);*/
                    //$("#list_items2").append(template);
                    /*
                    $("#list_items2").append(template);
                    $("#list_items2").append(template);
                    $("#list_items2").append(template);
                    */
                    //$("#list_items3").append(template);
                    /*
                    $("#list_items3").append(template);
                    $("#list_items3").append(template);
                    $("#list_items3").append(template);
                    $("#list_items3").append(template);
                    */
                    //$("#all_list").append(template);
                    /*
                    $("#all_list").append(template);
                    $("#all_list").append(template);
                    $("#all_list").append(template);
                    $("#all_list").append(template);
                    $("#all_list").append(template);
                    $("#all_list").append(template);
                    $("#all_list").append(template);
                    $("#all_list").append(template);
                    */
            });
        }
        )
    });

    function addCart() {
        if ($("#username_login").val() == "") {
            $("#belum_login_kok").text("Silakan login terlebih dahulu sebelum melanjutkan transaksi yah!");
            $("#myModal2").modal("hide");
            $("#modalLogin").modal("show");
        } else {
            let kode_barang_cart = $("#kode_barang_cart").val();
            let jumlah_barang = $("#jumlah_item").val();
            
            if(jumlah_barang==0 || jumlah_barang=="") {
                $("#mhc_header").text("Konfirmasi");
                $("#mhc_body").text("Apakah Benar Item ini akan dihapus dari Keranjangmu?");
                $("#modalHapusCart").modal("show");
            } else {
                langsungAddCart();
            }
        }

    }

    function langsungAddCart() {
            let kode_barang_cart = $("#kode_barang_cart").val();
            let jumlah_barang = $("#jumlah_item").val();
            
            $.ajax({
                type: "POST",
                url: '/add/cart/',
                data: {
                    'csrfmiddlewaretoken' : csrfmiddlewaretokennya,
                    'kode_barang' : kode_barang_cart,
                    'jumlah_barang' : jumlah_barang,
                },
                success: function(data) {
                    if(data.status==true) {
                        
                        $("#konfirmasi_header").text("Berhasil Ditambahkan!");
                        $("#konfirmasi_body").text("Item: " + $("#header_modal2").text() + " di keranjangmu sekarang berjumlah: "+ jumlah_barang +" !");
                        $("#myModal2").modal("hide");
                       
                        if(data.jumlah_shopping>99) {
                            $("#jumlah_cart").text("99+");
                            $("#jumlah_cart2").text("99+");
                        } else {
                            $("#jumlah_cart").text(data.jumlah_shopping);
                            $("#jumlah_cart2").text(data.jumlah_shopping);
                        }
                        $("#myshoppingcart").empty();
                        $("#listCartHP").empty();
                        data.myshoppingcart.forEach(function(mydata) {
                            comp_hp = "<div class='p-2 m-2 border border-danger rounded' style='cursor:pointer' id='listHP_" + mydata.kode_produk.produk_kode +"'><div class='row'><div class='col-3 d-flex align-items-center'><img class='w-100  rounded ' src='"+ mydata.kode_produk.gambar1 +"'></div><div class='col-9 d-flex align-items-center  py-2'><strong style='font-size:12px'>"+ mydata.kode_produk.produk_nama.toUpperCase() + "<strong><br>Jumlah Shopping Cart: <strong>" + mydata.jumlah +"</strong> item (s)<br>Harga Satuan : " + ubahKeUang(mydata.kode_produk.produk_harga) +"<br>Total Belanja:" + ubahKeUang(mydata.total_harga) +"</div></div></div>";
                            comp_komputer = "<li class='p-1 m-2 border border-danger rounded' id='listComp_" + mydata.kode_produk.produk_kode +"' title='klik untuk membeli: " + mydata.kode_produk.produk_nama.toUpperCase() +"'><a class='dropdown-item' href='#' style='font-size:10px'><div class='row'><div class='col-3  d-flex align-items-center'><img class='w-100  rounded ' src='"+ mydata.kode_produk.gambar1 +"'></div><div class='col-9 d-flex align-items-center  py-2'><strong style='font-size:12px'>"+ mydata.kode_produk.produk_nama.toUpperCase() + "<strong><br>Jumlah Shopping Cart: <strong>" + mydata.jumlah +"</strong> item (s)<br>Harga Satuan : "+ ubahKeUang(mydata.kode_produk.produk_harga) +"<br>Total Belanja:" + ubahKeUang(mydata.total_harga) +"</div></div></a></li>";
                            $("#myshoppingcart").append(comp_komputer);
                            $("#listCartHP").append(comp_hp);
                            $("#listHP_" + mydata.kode_produk.produk_kode).click(function() {
                                get_produk_satu(mydata.kode_produk.produk_kode);
                            });
                            $("#listComp_" + mydata.kode_produk.produk_kode).click(function() {
                                get_produk_satu(mydata.kode_produk.produk_kode);
                            });
                            //print(mydata.kode_produk);
                        });
                        console.log(data);
                        $("#modalKonfirmasi").modal("show");    
                    } else {
                        $("#konfirmasi_header").text("Gagal Ditambahkan!");
                        $("#konfirmasi_body").text("Silakan Login terlebih dahulu untuk melanjutkan transaksi!");
                        $("#myModal2").modal("hide");
                        $("#modalKonfirmasi").modal("show");
                    }
                }
            });
    }

    function setwishlist() {
        $("#setwishlist").empty();
        $.ajax({
            type: "POST",
            url: "/wishlist/",
            data: {
                'csrfmiddlewaretoken':csrfmiddlewaretokennya,
                'produk_id': $("#kode_barang_cart").val(),
                'ubah':true,
            },
            success: function(data) {
                if(data.result==true) {
                    $("#setwishlist").append("<i class='fa fa-heart text-white fw-bold' style='font-size:20px;cursor:pointer;' title='remove from my wishlist!'></i>");
                }  else {
                    $("#setwishlist").append("<i class='fa fa-heart-o text-white fw-bold' style='font-size:20px;cursor:pointer;' title='add to my wishlist!'></i>");
                };
                $.ajax({
                    type: "PoST",
                    url: '/wishlist/jumlah/',
                    data : {
                        'csrfmiddlewaretoken':csrfmiddlewaretokennya
                    },
                    success: function(data) {
                        if (parseInt(data.result)>99) {
                            $("#jumlah_whislist").text("99+");
                            $("#jumlah_whislist2").text("99+");
                        } else {
                            $("#jumlah_whislist").text(data.result);
                            $("#jumlah_whislist2").text(data.result);
                        }
                    }
                });
            }
        });
    }

    function update_jumlah() {
        harga = parseInt($("#harga_asli").val());
        jumlah = parseInt($("#jumlah_item").val());
        
        if($("#jumlah_item").val()=="") {
            $("#harga_totalnya").text("Rp.0,00");
            
        } else {
            $("#harga_totalnya").text(ubahKeUang(harga*jumlah));
    
        }

        console.log($("#harga_totalnya").text());
    }

    function hapusCart() {
        $.ajax({
            type: "POST",
            url: "/del/cart/",
            data: {
                'csrfmiddlewaretoken':csrfmiddlewaretokennya,
                'kode_produk': $("#kode_barang_cart").val()
            },
            success: function(data) {
                if(data.result==true) {
                    $("#modalHapusCart").modal("hide");
                    $("#konfirmasi_header").text("Konfirmasi");
                    $("#konfirmasi_body").text("Item berhasil dihapus dari keranjangmu! Sekarang jumlah item di keranjangmu ada: " + data.jumlah + " item(s)!");
                    $("#myModal2").modal("hide");
                    $("#modalKonfirmasi").modal("show");

                    if(data.jumlah>99) {
                        $("#jumlah_cart").text("99+");
                        $("#jumlah_cart2").text("99+");
                    } else {
                        $("#jumlah_cart").text(data.jumlah);
                        $("#jumlah_cart2").text(data.jumlah);
                    }

                    $("#myshoppingcart").empty();
                    $("#listCartHP").empty();
                    if(data.myshoppingcart.length ==0) {
                        $("#myshoppingcart").html("<div class='px-2 py-4 text-center'>Belum ada barang dikeranjangmu!<br>yuk... mulai belanja!</div>");
                        $("#listCartHP").html("<div class='px-2 py-4 text-center'>Belum ada barang dikeranjangmu!<br>yuk... mulai belanja!</div>");
                    }
                    data.myshoppingcart.forEach(function(mydata){
                        comp_hp = "<div class='p-2 m-2 border border-danger rounded' style='cursor:pointer' id='listHP_" + mydata.kode_produk.produk_kode +"'><div class='row'><div class='col-3 d-flex align-items-center'><img class='w-100  rounded ' src='"+ mydata.kode_produk.gambar1 +"'></div><div class='col-9 d-flex align-items-center  py-2'><strong style='font-size:12px'>"+ mydata.kode_produk.produk_nama.toUpperCase() + "<strong><br>Jumlah Shopping Cart: <strong>" + mydata.jumlah +"</strong> item (s)<br>Harga Satuan : " + ubahKeUang(mydata.kode_produk.produk_harga) +"<br>Total Belanja:" + ubahKeUang(mydata.total_harga) +"</div></div></div>";
                        comp_komputer = "<li class='p-1 m-2 border border-danger rounded' id='listComp_" + mydata.kode_produk.produk_kode +"' title='klik untuk membeli: " + mydata.kode_produk.produk_nama.toUpperCase() +"'><a class='dropdown-item' href='#' style='font-size:10px'><div class='row'><div class='col-3  d-flex align-items-center'><img class='w-100  rounded ' src='"+ mydata.kode_produk.gambar1 +"'></div><div class='col-9 d-flex align-items-center  py-2'><strong style='font-size:12px'>"+ mydata.kode_produk.produk_nama.toUpperCase() + "<strong><br>Jumlah Shopping Cart: <strong>" + mydata.jumlah +"</strong> item (s)<br>Harga Satuan : "+ ubahKeUang(mydata.kode_produk.produk_harga) +"<br>Total Belanja:" + ubahKeUang(mydata.total_harga) +"</div></div></a></li>";
                        $("#myshoppingcart").append(comp_komputer);
                        $("#listCartHP").append(comp_hp);
                        $("#listHP_" + mydata.kode_produk.produk_kode).click(function() {
                            get_produk_satu(mydata.kode_produk.produk_kode);
                        });
                        $("#listComp_" + mydata.kode_produk.produk_kode).click(function() {
                            get_produk_satu(mydata.kode_produk.produk_kode);
                        });
                        
                    })


                } else {
                    $("#konfirmasi_header").text("Konfirmasi");
                    $("#konfirmasi_body").text("Item gagal dihapus dari Keranjang. apakah Item sudah pernah dihapus sebelumnya?");
                    $("#modalKonfirmasi").modal("show");
                }
            }
        });
    }

    function get_produk_satu(kode_produk) {
        $.ajax({
            type: "POST",
            url: "/get/cart/satu/",
            data: {
                'csrfmiddlewaretoken':csrfmiddlewaretokennya,
                'kode_produk': kode_produk
            },
            success: function(data) {
                let nama_produk = data.myshoppingcart.kode_produk.produk_nama;
                let deskripsi = data.myshoppingcart.kode_produk.produk_deskripsi;
                let jumlah = data.myshoppingcart.jumlah;
                let harga_satuan = data.myshoppingcart.harganya;
                let total_bayar = data.myshoppingcart.total_harga;

                let gambar = [];
                if (data.myshoppingcart.kode_produk.gambar1!=null)
                    gambar.push(data.myshoppingcart.kode_produk.gambar1);
                if (data.myshoppingcart.kode_produk.gambar2!=null)
                    gambar.push(data.myshoppingcart.kode_produk.gambar2);
                if (data.myshoppingcart.kode_produk.gambar3!=null)
                    gambar.push(data.myshoppingcart.kode_produk.gambar3);
                if (data.myshoppingcart.kode_produk.gambar4!=null)
                    gambar.push(data.myshoppingcart.kode_produk.gambar4);
                if (data.myshoppingcart.kode_produk.gambar5!=null)
                    gambar.push(data.myshoppingcart.kode_produk.gambar5);
                if (data.myshoppingcart.kode_produk.gambar6!=null)
                    gambar.push(data.myshoppingcart.kode_produk.gambar6);
                if (data.myshoppingcart.kode_produk.gambar7!=null)
                    gambar.push(data.myshoppingcart.kode_produk.gambar7);
                if (data.myshoppingcart.kode_produk.gambar8!=null)
                    gambar.push(data.myshoppingcart.kode_produk.gambar8);
                $("#gambar_model2").empty();      
                for(let i=0;i<gambar.length;i++) {
                    $("#gambar_model2").append(
                      "<img src='" + gambar[i]+"' class='items2 mx-2 rounded shadow' >"
                    );
                }  

                $("#setwishlist").empty();
                                    $.ajax({
                                        type: "POST",
                                        url: "/wishlist/",
                                        data: {
                                            'csrfmiddlewaretoken':csrfmiddlewaretokennya,
                                            'produk_id': data.myshoppingcart.kode_produk.produk_kode,
                                            'ubah':false,
                                        },
                                        success: function(data) {
                                            if(data.result==true) {
                                                $("#setwishlist").append("<i class='fa fa-heart text-white fw-bold' style='font-size:20px;cursor:pointer;' title='remove from my wishlist!'></i>");
                                            }  else {
                                                $("#setwishlist").append("<i class='fa fa-heart-o text-white fw-bold' style='font-size:20px;cursor:pointer;' title='add to my wishlist!'></i>");
                                            };
                                            
                            
                                        }
                                    });
                                 
                                    $("#header_modal2").text(data.myshoppingcart.kode_produk.produk_nama);
                                    $("#kode_barang_cart").val(data.myshoppingcart.kode_produk.produk_kode);
                                    $("#isi_modal2").html(data.myshoppingcart.kode_produk.produk_deskripsi);
                                    $("#harga2").text(ubahKeUang(data.myshoppingcart.kode_produk.produk_harga)); 
                                    $("#harga_asli").val(data.myshoppingcart.kode_produk.produk_harga);
                                    //get the jumlah :-)
                                    $.ajax({
                                        type: 'POST',
                                        url: '/get/cart/jumlah/',
                                        data: {
                                            'csrfmiddlewaretoken':csrfmiddlewaretokennya,
                                            'kode_barang':data.myshoppingcart.kode_produk.produk_kode
                                        },
                                        success: function(dataku) {
                                            $("#jumlah_item").val(dataku.jumlah);
                                            $("#harga_totalnya").text(ubahKeUang(parseInt(dataku.jumlah)*data.myshoppingcart.kode_produk.produk_harga));
                                        }
                                    });
                                    $("#myModal2").modal("show");
            }
            
        });
    }
</script>

{% endblock %}